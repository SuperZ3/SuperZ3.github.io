# HTTP协议发展

HTTP 协议是基于 TCP 协议构建的应用层协议，主要是为了传输超文本内容

## HTTP 1.x

最早诞生的 http/0.9，主要是为了传递简单的超文本内容。浏览器只要向服务器发送请求行，服务器会返回数据即可

随着浏览器的发展，需要通过 HTTP 传递的内容包括超文本，还包括图片、JS 文件等

所以需要浏览器告诉服务器请求的信息，包括页面的语言、接受的数据编码、数据的压缩类型等。而服务器也需要告诉浏览器返回的数据的数据类型、编码格式、压缩方法等信息

所以在请求/响应行的基础上，增加了请求头和请求体。将需要的数据信息以key:value对的形式放入请求/响应头中。将数据放入响应体中。如：

```javascript
// 请求头
accept: text/html
accept-encoding: gzip, deflate, br
accept-Charset: ISO-8859-1,utf-8
accept-language: zh-cn

// 响应头
content-encoding: br
content-type: text/html; charset=UTF-8
```

HTTP/1.0 中，每进行一次通信都需要建立一次 TCP 连接，为了节约性能 HTTP/1.1 引入了持久连接，允许一次 tcp 连接传输多次 http 请求，浏览器对一个域名，默认允许建立 6 个持久连接。同时提供了 cache 机制来减缓服务器压力。

## HTTP2.0  

HTTP/1.1通过建立的持久连接仍存在一些问题

1. TCP 的慢启动问题，为了适应网络，tcp 会先缓慢发送数据，然后再逐步增加发送的速度。但是对 HTTP 传输来说，有些小文件可以直接传输，但是却被慢启动影响了

2. 多条 TCP 连接竞争问题，当带宽充足时，每条 tcp 连接都会缓慢增加传输速度，带宽不足时都会减缓传输速度，带来的问题是有些优先级较高的资源如 html 文件、css 文件，可能会被优先级较低的资源如图片、视频影响，导致下载速度变慢

3. 队头阻塞问题，虽然 HTTP/1.1 采用了持久连接，但是在 tcp 中的各个请求，仍需一个个发送到服务端处理。如果一个请求耗费时间较长，那么后续的请求都会被延迟

为了解决慢启动和 TCP 连接竞争问题，HTTP/2 对一个域名只使用一个 TCP 长链接传输数据，这样整个页面只需要进行一次慢启动。对于队头阻塞，采用多路复用机制解决

+ 多路复用：
  - HTTP/2 添加了一个二进制分帧层，HTTP 请求经过二进制分帧层后，被分成一个个带有请求 ID 的帧，再通过协议将这些帧发送到服务器

  - 服务器根据不同的请求ID合并出完整的请求信息，然后可以根据不同的优先级比如是否有缓存的数据，来决定优先响应哪个请求，准备好响应数据后，同样经过二进制分帧层，分成一个个带有请求 ID 的帧，发送到浏览器

  - 浏览器接收到响应帧后，可以根据请求 ID，将数据提交给对应的请求

HTTP/2 的其它功能：

1. 请求/响应头部压缩

2. 服务器推送，例如服务器知道请求的 html 文件会引用的 css 文件，那么就会一并向浏览器发送这个 css

3. 可以设置请求优先级

三、HTTP/3
