<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.32">
    <link rel="icon"><meta name="description" content="前端学习, frontend learning, 教程,  Vue, React, JavaScript, Node, 博客"><meta name="keywords" content="sdf"><meta name="author" content="大地"><meta chartset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"><title>网络协议 | 大地</title>
    <link rel="modulepreload" href="/assets/app.9dca4400.js"><link rel="modulepreload" href="/assets/net.html.bd32c9e5.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/net.html.350f1430.js">
    <link rel="stylesheet" href="/assets/style.b5235dab.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">大地</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/frontend/" class="router-link-active" aria-label="前端基础"><!--[--><!--]--> 前端基础 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="日常总结"><span class="title">日常总结</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="日常总结"><span class="title">日常总结</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/daily/bugs/" class="" aria-label="工作bug"><!--[--><!--]--> 工作bug <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/daily/git/" class="" aria-label="git入门"><!--[--><!--]--> git入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法学习"><span class="title">算法学习</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法学习"><span class="title">算法学习</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/algorithm/learn/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/leetcode/" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/rust/" class="" aria-label="Rust"><!--[--><!--]--> Rust <!--[--><!--]--></a></div><div class="navbar-item"><a href="/basic/" class="" aria-label="计算机基础"><!--[--><!--]--> 计算机基础 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/SuperZ3" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/frontend/" class="router-link-active" aria-label="前端基础"><!--[--><!--]--> 前端基础 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="日常总结"><span class="title">日常总结</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="日常总结"><span class="title">日常总结</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/daily/bugs/" class="" aria-label="工作bug"><!--[--><!--]--> 工作bug <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/daily/git/" class="" aria-label="git入门"><!--[--><!--]--> git入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法学习"><span class="title">算法学习</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法学习"><span class="title">算法学习</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/algorithm/learn/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/leetcode/" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/rust/" class="" aria-label="Rust"><!--[--><!--]--> Rust <!--[--><!--]--></a></div><div class="navbar-item"><a href="/basic/" class="" aria-label="计算机基础"><!--[--><!--]--> 计算机基础 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/SuperZ3" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p class="sidebar-item sidebar-heading">JavaScript 基础 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/promise.html" class="sidebar-item" aria-label="Promise"><!--[--><!--]--> Promise <!--[--><!--]--></a><!----></li><li><a href="/frontend/generator.html" class="sidebar-item" aria-label="Generator"><!--[--><!--]--> Generator <!--[--><!--]--></a><!----></li><li><a href="/frontend/prototype.html" class="sidebar-item" aria-label="原型与原型链"><!--[--><!--]--> 原型与原型链 <!--[--><!--]--></a><!----></li><li><a href="/frontend/fetch.html" class="sidebar-item" aria-label="网络请求 API 与 Axios"><!--[--><!--]--> 网络请求 API 与 Axios <!--[--><!--]--></a><!----></li><li><a href="/frontend/websocket.html" class="sidebar-item" aria-label="WebSocket"><!--[--><!--]--> WebSocket <!--[--><!--]--></a><!----></li><li><a href="/frontend/test.html" class="sidebar-item" aria-label="Jest 使用"><!--[--><!--]--> Jest 使用 <!--[--><!--]--></a><!----></li><li><a href="/frontend/practicejs.html" class="sidebar-item" aria-label="JS 练习"><!--[--><!--]--> JS 练习 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">Vue 3 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/reactive.html" class="sidebar-item" aria-label="响应式基础"><!--[--><!--]--> 响应式基础 <!--[--><!--]--></a><!----></li><li><a href="/frontend/create.html" class="sidebar-item" aria-label="组件创建及更新"><!--[--><!--]--> 组件创建及更新 <!--[--><!--]--></a><!----></li><li><a href="/frontend/watch.html" class="sidebar-item" aria-label="侦听器"><!--[--><!--]--> 侦听器 <!--[--><!--]--></a><!----></li><li><a href="/frontend/lifecycle.html" class="sidebar-item" aria-label="生命周期钩子 Composition"><!--[--><!--]--> 生命周期钩子 Composition <!--[--><!--]--></a><!----></li><li><a href="/frontend/vuex.html" class="sidebar-item" aria-label="VUEX"><!--[--><!--]--> VUEX <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">React <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/react.html" class="sidebar-item" aria-label="react 执行过程"><!--[--><!--]--> react 执行过程 <!--[--><!--]--></a><!----></li><li><a href="/frontend/redux.html" class="sidebar-item" aria-label="Redux"><!--[--><!--]--> Redux <!--[--><!--]--></a><!----></li><li><a href="/frontend/reactrouter.html" class="sidebar-item" aria-label="React-Router"><!--[--><!--]--> React-Router <!--[--><!--]--></a><!----></li><li><a href="/frontend/jsx.html" class="sidebar-item" aria-label="React TODO"><!--[--><!--]--> React TODO <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">CSS <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/sass.html" class="sidebar-item" aria-label="Sass"><!--[--><!--]--> Sass <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">打包工具 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/webpack.html" class="sidebar-item" aria-label="Webpack 基础"><!--[--><!--]--> Webpack 基础 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading active">浏览器 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/runjs.html" class="sidebar-item" aria-label="JS 在浏览器执行过程"><!--[--><!--]--> JS 在浏览器执行过程 <!--[--><!--]--></a><!----></li><li><a href="/frontend/eventloop_b.html" class="sidebar-item" aria-label="浏览器事件循环与任务"><!--[--><!--]--> 浏览器事件循环与任务 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/net.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="网络协议"><!--[--><!--]--> 网络协议 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/frontend/net.html#五层网络模型" class="router-link-active router-link-exact-active sidebar-item" aria-label="五层网络模型"><!--[--><!--]--> 五层网络模型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/net.html#tcp" class="router-link-active router-link-exact-active sidebar-item" aria-label="TCP"><!--[--><!--]--> TCP <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/net.html#https" class="router-link-active router-link-exact-active sidebar-item" aria-label="HTTPS"><!--[--><!--]--> HTTPS <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/frontend/cache.html" class="sidebar-item" aria-label="浏览器缓存"><!--[--><!--]--> 浏览器缓存 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">Node <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/eventloop_n.html" class="sidebar-item" aria-label="Node 事件循环"><!--[--><!--]--> Node 事件循环 <!--[--><!--]--></a><!----></li><li><a href="/frontend/module.html" class="sidebar-item" aria-label="CommonJS"><!--[--><!--]--> CommonJS <!--[--><!--]--></a><!----></li><li><a href="/frontend/event.html" class="sidebar-item" aria-label="EventEmitter"><!--[--><!--]--> EventEmitter <!--[--><!--]--></a><!----></li><li><a href="/frontend/stream.html" class="sidebar-item" aria-label="Stream"><!--[--><!--]--> Stream <!--[--><!--]--></a><!----></li><li><a href="/frontend/koa.html" class="sidebar-item" aria-label="Koa"><!--[--><!--]--> Koa <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="网络协议" tabindex="-1"><a class="header-anchor" href="#网络协议" aria-hidden="true">#</a> 网络协议</h1><p>为了在两台计算机之间传递数据，需要一套统一的标准，这就是网络协议的作用</p><h2 id="五层网络模型" tabindex="-1"><a class="header-anchor" href="#五层网络模型" aria-hidden="true">#</a> 五层网络模型</h2><p>为了方便学习和理解，将 OSI 模型基础概括为五层</p><ol><li><p>应用层（application layer）：指的是应用进程间的交互，如万维网应用 HTTP 协议、文件传送 FTP 协议等，一般应用层交互的数据单元叫报文（message）</p></li><li><p>传输层（transport layer）：为应用层提供通用的数据传输服务，主要包括 TCP 和 UDP 协议</p></li><li><p>网络层（network layer）：为分组交换网上不同主机提供通信服务，把传输层的报文段封装成组或包（packet）传输</p></li><li><p>数据链路层（data link layer）：将网络层的数据报组装成帧，在节点间传输</p></li><li><p>物理层：传输比特数据</p></li></ol><p>数据在传输中可能经过多个设备，每个设备中数据都会经过这 5 层中的某几层处理，最终到达目标地址</p><p><img src="/assets/layer.502b57a9.png" alt="image"></p><h2 id="tcp" tabindex="-1"><a class="header-anchor" href="#tcp" aria-hidden="true">#</a> TCP</h2><p>然后将报文交给传输层处理，以 TCP 协议为例，传输层会将报文数据分段处理，在每段上加 TCP 头，包括源端口号、目标端口号、序列号等</p><p>TCP 是面向连接的、可靠的、基于字节流的传输层通信协议：</p><ul><li><p>面向连接：数据传输之前需要验证是否可以传输数据，以保证可以双向传递字节流</p></li><li><p>可靠：会对数据进行摘要，保证数据不会修改，并增加序列号，保证数据不会缺失</p></li></ul><p>TCP 协议会在数据前加上 TCP 头，包含如下组成部分：</p><p><img src="/assets/tcp.8566768d.png" alt="image"></p><ol><li><p>源端口和目标端口加上 IP 首部中的源地址和目标地址，确定一个唯一的 TCP 连接</p></li><li><p>seq 序号：发送数据的第一个字节的序号</p></li><li><p>ack 序号：期望对方下次发送数据第一个字节的序号，只有 ACK 标志为 1 时，才有效</p></li><li><p>数据偏移：TCP 首部长度</p></li><li><p>标志位：各 1 位长</p></li></ol><ul><li><p>URG：为 1 时表示此段尽快传送，与紧急指针共用</p></li><li><p>ACK：为 1 时 ack 序号才有效</p></li><li><p>PSH：为 1 时，接收方应尽快将本报文段推送给应用层</p></li><li><p>RST：为 1 时表示出现连接错误，必须释放连接</p></li><li><p>SYN：SYN=1，ACK=0 时表示请求建立一个连接</p></li><li><p>FIN：发送端完成发送任务，在关闭TCP连接的时候使用</p></li></ul><ol start="6"><li><p>窗口：TCP 用来进行流量控制，发送端对所有数据帧按顺序赋予编号，在发送过程中保持一个发送窗口，落在发送窗口内的帧才允许发送，接收端维持一个接收窗口，落在窗口内的帧才允许接收</p></li><li><p>校验和：发送端计算、接收端验证保证数据准确性</p></li></ol><p>在传输数据前需要通过三次握手和四次挥手建立连接</p><p><img src="/assets/shake.810d5d1d.png" alt="image"></p><ul><li><p>3 次握手：</p><ul><li><p>浏览器发送 SYN = 1，ACK = 0 与请求服务器建立连接，同时发送浏览器端序列号 seq = x</p></li><li><p>服务器发送 SYN = 1 请求与浏览器建立连接，同时发送 ACK = 1 使 ack = x + 1 序列号可以使用，并发送服务器端序列号 seq = y</p></li><li><p>浏览器回应 ACK = 1 同意与服务器建立连接，同时发送 ack = y + 1，seq = x + 2 序列号</p></li></ul></li></ul><p>此时，浏览器、服务器均验证了与对方发送消息是可行的，建立了双工连接。</p><p>一段时间后，假设浏览器传输数据完成，则调用 close 关闭连接，此时会经历 4 次挥手阶段：</p><ul><li><p>4 次挥手：</p><ul><li><p>浏览器发送 FIN = 1，ACK = 1 表示想要断开连接，上图一次传输，中间未传输其它数据，所以 ack = y + 1，seq = x + 1</p></li><li><p>服务器若有数据传输则先回复一个 ACK = 1，若没有数据传输，此次传输可能不存在</p></li><li><p>服务器调用 close 关闭与浏览器的连接，发送 FIN = 1，ACK = 1</p></li><li><p>浏览器确认与服务器端断开连接，发送 ACK = 1</p></li></ul></li></ul><p>至此，一次 TCP 传输完成，要注意断开连接时挥手可能为 4 次也可能为 3 次，与服务器是否仍有数据需要发送有关</p><h2 id="https" tabindex="-1"><a class="header-anchor" href="#https" aria-hidden="true">#</a> HTTPS</h2><p>HTTPS 在 HTTP 和 TCP 间增加了一个安全层，以保证明文 HTTP 数据不会在传输过程中被中间人攻击</p><p>HTTPS 采用非对称加密 + 对称加密 + CA 认证的方式实现数据的加密，大致过程如下：</p><p><img src="/assets/https.b2d0eed2.png" alt="image"></p><ol><li><p>浏览器将可用的对称/非对称加密套件列表和随机数发给服务器</p></li><li><p>服务器选择对称/非对称加密套件并将 CA 证书一起发给浏览器，CA 证书包括两部分：</p></li></ol><ul><li>由服务器公钥、组织信息、证书序列号等明文信息</li><li>CA 使用 Hash 对明文信息计算摘要，并用私钥加密摘要信息，得到数字签名</li></ul><p><img src="/assets/CA.ae7174c1.png" alt="image"></p><ol start="3"><li>浏览器验证数字证书：</li></ol><ul><li>用 Hash 计算 CA 证书的明文信息得到摘要 A</li><li>用 CA 的公钥解密 CA 的数字签名得到摘要 B，对比摘要 A 和 B</li></ul><ol start="4"><li><p>验证成功后，生成随机数 pre-master 并用服务器的公钥加密后传给服务器</p></li><li><p>浏览器和服务器分别用得到的 client-random、server-random、pre-master 计算出 master-secret</p></li><li><p>用 master secret 加密传输的数据</p></li></ol><!--]--></div><footer class="page-meta"><!----><!----><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: zhangzz1024@163.com">SuperZ3</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/frontend/eventloop_b.html" class="" aria-label="浏览器事件循环与任务"><!--[--><!--]--> 浏览器事件循环与任务 <!--[--><!--]--></a></span><span class="next"><a href="/frontend/cache.html" class="" aria-label="浏览器缓存"><!--[--><!--]--> 浏览器缓存 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.9dca4400.js" defer></script>
  </body>
</html>
