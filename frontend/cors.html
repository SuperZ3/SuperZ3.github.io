<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.32">
    <link rel="icon"><meta name="description" content="前端学习, frontend learning, 教程,  Vue, React, JavaScript, Node, 博客"><meta name="keywords" content="sdf"><meta name="author" content="大地"><meta chartset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"><title>跨域资源共享 | 大地</title>
    <link rel="modulepreload" href="/assets/app.9dca4400.js"><link rel="modulepreload" href="/assets/cors.html.0865eb6d.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/cors.html.87527e41.js">
    <link rel="stylesheet" href="/assets/style.b5235dab.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">大地</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/frontend/" class="router-link-active" aria-label="前端基础"><!--[--><!--]--> 前端基础 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="日常总结"><span class="title">日常总结</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="日常总结"><span class="title">日常总结</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/daily/bugs/" class="" aria-label="工作bug"><!--[--><!--]--> 工作bug <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/daily/git/" class="" aria-label="git入门"><!--[--><!--]--> git入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法学习"><span class="title">算法学习</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法学习"><span class="title">算法学习</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/algorithm/learn/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/leetcode/" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/rust/" class="" aria-label="Rust"><!--[--><!--]--> Rust <!--[--><!--]--></a></div><div class="navbar-item"><a href="/basic/" class="" aria-label="计算机基础"><!--[--><!--]--> 计算机基础 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/SuperZ3" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/frontend/" class="router-link-active" aria-label="前端基础"><!--[--><!--]--> 前端基础 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="日常总结"><span class="title">日常总结</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="日常总结"><span class="title">日常总结</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/daily/bugs/" class="" aria-label="工作bug"><!--[--><!--]--> 工作bug <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/daily/git/" class="" aria-label="git入门"><!--[--><!--]--> git入门 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法学习"><span class="title">算法学习</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法学习"><span class="title">算法学习</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/algorithm/learn/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/algorithm/leetcode/" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/rust/" class="" aria-label="Rust"><!--[--><!--]--> Rust <!--[--><!--]--></a></div><div class="navbar-item"><a href="/basic/" class="" aria-label="计算机基础"><!--[--><!--]--> 计算机基础 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/SuperZ3" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p class="sidebar-item sidebar-heading">JavaScript 基础 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/promise.html" class="sidebar-item" aria-label="Promise"><!--[--><!--]--> Promise <!--[--><!--]--></a><!----></li><li><a href="/frontend/generator.html" class="sidebar-item" aria-label="Generator"><!--[--><!--]--> Generator <!--[--><!--]--></a><!----></li><li><a href="/frontend/prototype.html" class="sidebar-item" aria-label="原型与原型链"><!--[--><!--]--> 原型与原型链 <!--[--><!--]--></a><!----></li><li><a href="/frontend/fetch.html" class="sidebar-item" aria-label="网络请求 API 与 Axios"><!--[--><!--]--> 网络请求 API 与 Axios <!--[--><!--]--></a><!----></li><li><a href="/frontend/websocket.html" class="sidebar-item" aria-label="WebSocket"><!--[--><!--]--> WebSocket <!--[--><!--]--></a><!----></li><li><a href="/frontend/test.html" class="sidebar-item" aria-label="Jest 使用"><!--[--><!--]--> Jest 使用 <!--[--><!--]--></a><!----></li><li><a href="/frontend/practicejs.html" class="sidebar-item" aria-label="JS 练习"><!--[--><!--]--> JS 练习 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">Vue 3 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/reactive.html" class="sidebar-item" aria-label="响应式基础"><!--[--><!--]--> 响应式基础 <!--[--><!--]--></a><!----></li><li><a href="/frontend/create.html" class="sidebar-item" aria-label="组件创建及更新"><!--[--><!--]--> 组件创建及更新 <!--[--><!--]--></a><!----></li><li><a href="/frontend/watch.html" class="sidebar-item" aria-label="侦听器"><!--[--><!--]--> 侦听器 <!--[--><!--]--></a><!----></li><li><a href="/frontend/lifecycle.html" class="sidebar-item" aria-label="生命周期钩子 Composition"><!--[--><!--]--> 生命周期钩子 Composition <!--[--><!--]--></a><!----></li><li><a href="/frontend/vuex.html" class="sidebar-item" aria-label="VUEX"><!--[--><!--]--> VUEX <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">React <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/react.html" class="sidebar-item" aria-label="react 执行过程"><!--[--><!--]--> react 执行过程 <!--[--><!--]--></a><!----></li><li><a href="/frontend/redux.html" class="sidebar-item" aria-label="Redux"><!--[--><!--]--> Redux <!--[--><!--]--></a><!----></li><li><a href="/frontend/reactrouter.html" class="sidebar-item" aria-label="React-Router"><!--[--><!--]--> React-Router <!--[--><!--]--></a><!----></li><li><a href="/frontend/jsx.html" class="sidebar-item" aria-label="React TODO"><!--[--><!--]--> React TODO <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">CSS <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/sass.html" class="sidebar-item" aria-label="Sass"><!--[--><!--]--> Sass <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">打包工具 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/webpack.html" class="sidebar-item" aria-label="Webpack 基础"><!--[--><!--]--> Webpack 基础 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">浏览器 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/runjs.html" class="sidebar-item" aria-label="JS 在浏览器执行过程"><!--[--><!--]--> JS 在浏览器执行过程 <!--[--><!--]--></a><!----></li><li><a href="/frontend/eventloop_b.html" class="sidebar-item" aria-label="浏览器事件循环与任务"><!--[--><!--]--> 浏览器事件循环与任务 <!--[--><!--]--></a><!----></li><li><a href="/frontend/net.html" class="sidebar-item" aria-label="网络协议"><!--[--><!--]--> 网络协议 <!--[--><!--]--></a><!----></li><li><a href="/frontend/cache.html" class="sidebar-item" aria-label="浏览器缓存"><!--[--><!--]--> 浏览器缓存 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">Node <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/frontend/eventloop_n.html" class="sidebar-item" aria-label="Node 事件循环"><!--[--><!--]--> Node 事件循环 <!--[--><!--]--></a><!----></li><li><a href="/frontend/module.html" class="sidebar-item" aria-label="CommonJS"><!--[--><!--]--> CommonJS <!--[--><!--]--></a><!----></li><li><a href="/frontend/event.html" class="sidebar-item" aria-label="EventEmitter"><!--[--><!--]--> EventEmitter <!--[--><!--]--></a><!----></li><li><a href="/frontend/stream.html" class="sidebar-item" aria-label="Stream"><!--[--><!--]--> Stream <!--[--><!--]--></a><!----></li><li><a href="/frontend/koa.html" class="sidebar-item" aria-label="Koa"><!--[--><!--]--> Koa <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="跨域资源共享" tabindex="-1"><a class="header-anchor" href="#跨域资源共享" aria-hidden="true">#</a> 跨域资源共享</h1><h2 id="浏览器同源策略" tabindex="-1"><a class="header-anchor" href="#浏览器同源策略" aria-hidden="true">#</a> 浏览器同源策略</h2><p>限制一个源（A URL）的文档和其脚本与另一个源（B URL）的资源交互。出于安全性考虑，浏览器不能拿到与当前页面非同源的资源（协议、域名、端口号有一个不同，就是非同源）</p><p>请求非同源地址，会带来以下限制：</p><ol><li><p>无法读取非同源网页的 Cookie、LocalStorage 和 IndexedDB</p></li><li><p>无法接触非同源网页的 DOM</p></li><li><p>无法向非同源地址发送 AJAX 请求</p></li></ol><h2 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案" aria-hidden="true">#</a> 解决方案</h2><ol><li><p>针对相同主域名，多个页面设置相同的 document.domain 属性，以共享 cookie</p></li><li><p>父子窗口通过 window.postMessage 通信</p></li><li><p>内容安全策略：CSP（设置 Content-Security-Policy 头）控制用户代理（浏览器）可以获取哪些资源</p></li><li><p>JSONP，利用 script 标签可以跨域的特点，在 src 属性中请求数据，缺点是只有 get 请求</p></li><li><p>CORS（cross-origin resource sharing）跨域资源共享，是由浏览器及服务器参与的，基于HTTP头的验证，进而传输数据的一种机制。</p></li></ol><h2 id="cors" tabindex="-1"><a class="header-anchor" href="#cors" aria-hidden="true">#</a> CORS</h2><p>首先看一下请求分类，浏览器将请求分为简单请求、复杂请求，简单请求需同时满足以下条件：</p><p>a. 请求方法是以下三种方法之一：HEAD、GET、POST</p><p>b. HTTP的头信息不超出以下几种字段：Accept、Accept-Language、Content-Language、Last-Event-ID</p><p>c. Content-Type 只限于 application/x-www-form-urlencoded、multipart/form-data、text/plain</p><p>d. 请求中没有使用 ReadableStream 对象</p><p>CORS 怎么生效的？浏览器发送请求给服务端，如果响应头不包含 Access-Control-Allow-Origin，那么浏览器就会将返回的结果抛弃</p><p>简单请求，服务器只需要根据请求头的 Origin：url 字段判断是否在响应头添加Access-Control-Allow-Origin 字段，即可控制浏览器请求的内容</p><p>由于请求不带 Cookie 和 token 等身份凭证信息，所以要发送认证信息，需要设置 XHR 对象withCredentials=true，且服务器不得设置 Access-Control-Allow-Origin 的值为 * 。“同时，Cookie依然遵循同源政策，只有用服务器域名设置的Cookie才会上传，其他域名的Cookie并不会上传，且（跨源）原网页代码中的document.cookie也无法读取服务器域名下的Cookie。”</p><p>复杂请求，如PUT、DELETE，会先发送预检请求 OPTION，发送包含 Access-Control-Request-Method、Access-Control-Request-Headers 头告诉服务器正式请求的方法和自定义头部信息，服务器基于从预检请求获得的信息来判断，是否接受接下来的实际请求</p><p>接下来验证一下解决方案1~4：</p><p>1、针对相同主域名，多个页面设置相同的document.domain属性，以共享cookie</p><p>参考：</p><ol><li>http://www.ruanyifeng.com/blog/2016/04/cors.html</li><li>https://blog.csdn.net/qq_38128179/article/details/84956552</li><li>https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS</li></ol><!--]--></div><footer class="page-meta"><!----><!----><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: zhangzz1024@163.com">SuperZ3</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.9dca4400.js" defer></script>
  </body>
</html>
